<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Advanced A.I. SEO Analyzer</title>

  <!-- Include the Compromise NLP library from a CDN -->
  <script src="https://unpkg.com/compromise@13.11.2/builds/compromise.min.js"></script>

  <style>
    /* Base Styling */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      background: #f0f2f5;
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      color: #333;
      transition: background 0.3s, color 0.3s;
    }
    header {
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #fff;
    }
    .nav-left a {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 12px;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.95em;
      transition: background 0.3s ease;
    }
    .nav-left a:hover {
      background: rgba(255, 255, 255, 0.4);
    }
    .header-center {
      text-align: center;
      flex-grow: 1;
    }
    .header-center h1 {
      margin: 0;
      font-size: 2.5em;
      font-weight: 500;
    }
    .header-center p {
      margin: 5px 0 0;
      font-size: 1em;
      opacity: 0.9;
    }
    .toggle-dark {
      margin-left: 10px;
    }
    .toggle-dark button {
      background: #fff;
      color: #1e3c72;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.3s ease, color 0.3s ease;
    }
    /* Hover effect for dark/light toggle in light mode */
    .toggle-dark button:hover {
      background: #e0e0e0;
    }
    /* Dark mode override for toggle button hover */
    .dark-mode .toggle-dark button:hover {
      background: #444;
    }

    /* Container */
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: background 0.3s, color 0.3s;
    }
    .analysis,
    .result-section {
      transition: background 0.3s, color 0.3s;
    }
    .input-group {
      margin-bottom: 20px;
    }
    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .input-group select,
    .input-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      transition: border-color 0.3s ease, background 0.3s, color 0.3s;
    }
    .input-group select:focus,
    .input-group textarea:focus {
      outline: none;
      border-color: #1e3c72;
    }
    button {
      background-color: #1e3c72;
      color: #fff;
      border: none;
      padding: 15px;
      width: 100%;
      border-radius: 4px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-top: 10px;
    }
    button:hover {
      background-color: #2c4d8f;
    }
    .dark-mode button:hover {
      background-color: #16335c;
    }

    .result-section h2 {
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #ddd;
      font-weight: 600;
    }
    .result-section p,
    .result-section li {
      line-height: 1.6;
    }
    .highlight {
      background-color: #ffeb3b;
      padding: 2px 4px;
      border-radius: 3px;
      cursor: help;
    }
    .results-box {
      background: #f7f7f7;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-top: 10px;
      font-family: Consolas, monospace;
      white-space: pre-wrap;
      transition: background 0.3s;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table,
    th,
    td {
      border: 1px solid #ddd;
    }
    th,
    td {
      padding: 10px;
      text-align: left;
      font-size: 0.95em;
    }
    th {
      background-color: #f9f9f9;
      font-weight: 600;
    }
    .toggle-btn {
      background: #1e3c72;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      font-size: 0.9em;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .info {
      background: #eef2f7;
      border: 1px solid #ccd4db;
      border-radius: 4px;
      padding: 15px;
      margin-top: 30px;
      font-size: 0.95em;
      line-height: 1.5;
      transition: background 0.3s, color 0.3s;
    }
    
    /* Dark Mode Styles */
    .dark-mode body {
      background: #121212;
      color: #e0e0e0;
    }
    .dark-mode header {
      background: #1c1c1c;
    }
    .dark-mode .container {
      background: #1e1e1e;
      color: #e0e0e0;
    }
    .dark-mode .analysis,
    .dark-mode .result-section {
      background: #1e1e1e;
      color: #e0e0e0;
    }
    .dark-mode .result-section h2 {
      border-bottom-color: #444;
    }
    .dark-mode .results-box {
      background: #2a2a2a;
      border: 1px solid #444;
    }
    .dark-mode table,
    .dark-mode th,
    .dark-mode td {
      border: 1px solid #444;
    }
    .dark-mode th {
      background-color: #333;
    }
    .dark-mode .info {
      background: #1c1c1c;
      border: 1px solid #333;
      color: #e0e0e0;
    }
    .dark-mode .toggle-dark button {
      background: #333;
      color: #fff;
    }
    .dark-mode .toggle-dark button:hover {
      background: #444;
    }
    .dark-mode .highlight {
      background-color: #cc9900;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-left">
      <a href="index.html">&larr; Return Home</a>
    </div>
    <div class="header-center">
      <h1>Advanced A.I. SEO Analyzer</h1>
      <p>Professional analysis for cutting-edge SEO performance</p>
    </div>
    <div class="toggle-dark">
      <button id="darkModeBtn">Activate Dark Mode</button>
    </div>
  </header>
  
  <div class="container">
    <!-- Niche Dropdown (Required) -->
    <div class="input-group">
      <label for="niche">Your Niche: <span style="color:red;">*</span></label>
      <select id="niche" required>
        <option value="">-- Select Your Niche --</option>
        <option value="tech">Tech</option>
        <option value="sustainability">Sustainability</option>
        <option value="finance">Finance</option>
        <option value="health">Health</option>
        <option value="travel">Travel</option>
        <option value="education">Education</option>
        <option value="fashion">Fashion</option>
        <option value="food">Food</option>
        <option value="real estate">Real Estate</option>
        <option value="entertainment">Entertainment</option>
        <option value="automotive">Automotive</option>
        <option value="sports">Sports</option>
        <option value="beauty">Beauty</option>
        <option value="retail">Retail</option>
        <option value="gaming">Gaming</option>
        <option value="lifestyle">Lifestyle</option>
        <option value="business">Business</option>
        <option value="legal">Legal</option>
        <option value="home improvement">Home Improvement</option>
        <option value="parenting">Parenting</option>
        <option value="marketing">Marketing</option>
        <option value="art & culture">Art & Culture</option>
      </select>
    </div>
    
    <!-- Main Copy Input (maxlength 5000) -->
    <div class="input-group">
      <label for="copy">Your Copy:</label>
      <textarea id="copy" rows="10" maxlength="5000" placeholder="Paste your text here..."></textarea>
    </div>
    
    <!-- Analyze Button -->
    <button id="analyzeBtn">Analyze SEO</button>
    
    <!-- Analysis Results -->
    <div id="results" class="analysis"></div>
    
    <!-- Info Section -->
    <div class="info">
      <h2>How It Works</h2>
      <p>
        This version uses the Compromise NLP library to extract nouns and entities, rather than relying on raw tokens. 
        We add safety checks to avoid errors if Compromise returns undefined items. 
        Dark Mode changes all white areas to dark, including the container background, ensuring a cohesive high-contrast experience.
      </p>
    </div>
  </div>
  
  <script>
    /************************************************
     * Dark Mode Toggle
     ************************************************/
    const darkModeBtn = document.getElementById("darkModeBtn");
    darkModeBtn.addEventListener("click", function() {
      document.body.classList.toggle("dark-mode");
      if (document.body.classList.contains("dark-mode")) {
        darkModeBtn.textContent = "Activate Light Mode";
      } else {
        darkModeBtn.textContent = "Activate Dark Mode";
      }
    });
    function isDarkMode() {
      return document.body.classList.contains("dark-mode");
    }

    /************************************************
     * Overused SEO Keywords (Highlight)
     ************************************************/
    const overusedWords = [
      "best", "top", "quality", "expert", "affordable", "solution", "unique", "leading",
      "powerful", "reliable", "trusted", "proven", "innovative", "cutting-edge",
      "state-of-the-art", "free", "guaranteed", "amazing", "ultimate", "essential",
      "premium", "efficient", "advanced", "strategic", "professional", "dynamic",
      "holistic", "comprehensive", "optimal", "incredible", "remarkable"
    ];

    /************************************************
     * Stopwords / Ignore List
     ************************************************/
    const ignoreWords = (`
a about above across after afterwards again against all almost alone along already also although always am among amongst ...
`).split(/\s+/);

    /************************************************
     * Example Niche Mapping & Known Keywords
     ************************************************/
    const nicheMapping = {
      "tech": [
        "ai","machine","learning","technology","tech","robotics","data","science",
        "innovation","software","hardware","cybersecurity","gadgets","iot",
        "cloud","big","automation","blockchain"
      ],
      "parenting": [
        "parenting","kids","children","family","mom","dad","parent","childcare",
        "baby","toddler","advice","support","growth"
      ],
      // ... add other niches as needed ...
    };

    // Build knownKeywords
    const knownKeywords = {};
    for (const niche in nicheMapping) {
      nicheMapping[niche].forEach(k => {
        knownKeywords[k.toLowerCase()] = niche;
      });
    }

    /************************************************
     * Advanced Keyword Extraction (Compromise)
     ************************************************/
    function advancedExtractKeywords(copy) {
      const doc = nlp(copy);
      const freqMap = {};

      // Get nouns & entities
      const nounFreq = doc.nouns().out('freq') || [];
      const entityFreq = doc.entities().out('freq') || [];

      // Merge them into freqMap
      nounFreq.forEach(item => {
        if (!item || !item.normal) return; // Avoid undefined
        const w = item.normal.toLowerCase();
        freqMap[w] = (freqMap[w] || 0) + (item.count || 1);
      });
      entityFreq.forEach(item => {
        if (!item || !item.normal) return;
        const w = item.normal.toLowerCase();
        freqMap[w] = (freqMap[w] || 0) + (item.count || 1);
      });

      return freqMap;
    }

    /************************************************
     * Context Logic (Example: Parenting)
     ************************************************/
    function isContextuallyRelevant(word, niche, doc) {
      if (niche.toLowerCase() !== "parenting") return false;

      // Words that we might want to keep if near parenting cues
      const relevantParentingWords = ["advice","tips","age"];
      if (!relevantParentingWords.includes(word.toLowerCase())) {
        return false;
      }
      // Check context words
      const parentingContextWords = ["mom","dad","child","children","baby","kids","family","parenting"];
      for (let cw of parentingContextWords) {
        const near1 = `${cw} .{0,5} ${word}`;
        const near2 = `${word} .{0,5} ${cw}`;
        if (doc.match(near1).found || doc.match(near2).found) {
          return true;
        }
      }
      return false;
    }

    /************************************************
     * Color Helpers
     ************************************************/
    let totalWordsCount = 0;

    // Niche colors (light & dark placeholders)
    const nicheColors = {
      "tech": "#d1ecf1",
      "parenting": "#fde8e8",
      // etc...
    };
    const darkNicheColors = {
      "tech": "#4d8ba8",
      "parenting": "#d9534f",
      // etc...
    };

    function getColorForNiche(niche) {
      if (!niche) return "#ffffff";
      const nicheLower = niche.toLowerCase();
      if (isDarkMode() && darkNicheColors[nicheLower]) {
        return darkNicheColors[nicheLower];
      }
      return nicheColors[nicheLower] || "#ffffff";
    }

    function getOccurrencesColor(occurrences, avg) {
      const baseRatio = occurrences / totalWordsCount;
      if (avg > 0) {
        if (occurrences >= 3 * avg) {
          return isDarkMode() ? "#8B0000" : "#ffcccc";
        } else if (occurrences >= 2 * avg) {
          return isDarkMode() ? "#B8860B" : "#fff5cc";
        }
      }
      if (baseRatio > 0.1) {
        return isDarkMode() ? "#8B0000" : "#ffcccc";
      } else if (baseRatio > 0.05) {
        return isDarkMode() ? "#B8860B" : "#fff5cc";
      }
      return isDarkMode() ? "#006400" : "#ccffcc";
    }

    function getCertaintyColor(certainty) {
      if (typeof certainty === "number") {
        if (certainty >= 70) {
          return isDarkMode() ? "#006400" : "#ccffcc";
        } else if (certainty >= 40) {
          return isDarkMode() ? "#B8860B" : "#fff5cc";
        } else {
          return isDarkMode() ? "#8B0000" : "#ffcccc";
        }
      }
      return isDarkMode() ? "#8B0000" : "#ffcccc";
    }

    /************************************************
     * Main Analysis Logic
     ************************************************/
    document.getElementById('analyzeBtn').addEventListener('click', function() {
      const inputNiche = document.getElementById('niche').value.trim();
      const copy = document.getElementById('copy').value.trim();
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = "";

      if (!inputNiche) {
        resultsDiv.innerHTML = '<p style="color:red;">Please select your niche to proceed.</p>';
        return;
      }
      if (!copy) {
        resultsDiv.innerHTML = '<p>Please enter some copy to analyze.</p>';
        return;
      }

      // 1) Highlight Overused Words
      const overusedRegex = new RegExp('\\b(' + overusedWords.join('|') + ')\\b', 'gi');
      const highlightedCopy = copy.replace(overusedRegex, function(match) {
        return `<span class="highlight" title="Overused: consider synonyms.">${match}</span>`;
      });

      // 2) Use advanced extraction
      const doc = nlp(copy);
      const freqMap = advancedExtractKeywords(copy);
      totalWordsCount = doc.wordCount();

      // 3) Build relevant vs different arrays
      const relevantKeywords = [];
      const differentKeywords = [];
      const inputNicheLower = inputNiche.toLowerCase();

      for (const [word, occurrences] of Object.entries(freqMap)) {
        // If in ignoreWords, skip unless context allows it
        if (ignoreWords.includes(word)) {
          if (!isContextuallyRelevant(word, inputNiche, doc)) {
            continue;
          }
        }

        if (knownKeywords[word]) {
          const knownNiche = knownKeywords[word];
          if (knownNiche.toLowerCase() === inputNicheLower) {
            relevantKeywords.push({
              niche: knownNiche,
              keyword: word + " (known)",
              occurrences,
              certainty: 100
            });
          } else {
            differentKeywords.push({
              niche: knownNiche,
              keyword: word + " (known)",
              occurrences,
              certainty: 100
            });
          }
        } else {
          // guess
          const guess = guessNiche(word);
          if (guess) {
            if (guess.niche.toLowerCase() === inputNicheLower) {
              relevantKeywords.push({
                niche: "Guessed: " + guess.niche,
                keyword: word + " (guessed)",
                occurrences,
                certainty: guess.confidence
              });
            } else {
              differentKeywords.push({
                niche: "Guessed: " + guess.niche,
                keyword: word + " (guessed)",
                occurrences,
                certainty: guess.confidence
              });
            }
          }
        }
      }

      // Sort relevant & different
      relevantKeywords.sort((a, b) => {
        if (a.niche < b.niche) return -1;
        if (a.niche > b.niche) return 1;
        return a.keyword.localeCompare(b.keyword);
      });
      differentKeywords.sort((a, b) => {
        if (a.niche < b.niche) return -1;
        if (a.niche > b.niche) return 1;
        return a.keyword.localeCompare(b.keyword);
      });

      // Compute average occurrences for relevant
      let avgOccurrence = 0;
      if (relevantKeywords.length > 0) {
        const sumOcc = relevantKeywords.reduce((sum, it) => sum + it.occurrences, 0);
        avgOccurrence = sumOcc / relevantKeywords.length;
      }

      // 4) Overused SEO Words Analysis
      const overusedCounts = {};
      overusedWords.forEach(ow => {
        const regex = new RegExp('\\b' + ow + '\\b', 'gi');
        const matches = copy.match(regex);
        overusedCounts[ow] = matches ? matches.length : 0;
      });

      let overusedHTML = '<div class="result-section"><h2>Overused SEO Keywords Analysis</h2><ul>';
      let foundOverused = false;
      for (const [oword, count] of Object.entries(overusedCounts)) {
        if (count > 0) {
          foundOverused = true;
          overusedHTML += `<li><strong>${oword}</strong>: ${count} occurrence${count>1?'s':''}</li>`;
        }
      }
      overusedHTML += '</ul>';
      if (!foundOverused) {
        overusedHTML += '<p>No overused SEO keywords were detected in your copy!</p>';
      } else {
        overusedHTML += '<p>Review the highlighted terms above; consider using synonyms for a more natural language flow.</p>';
      }
      overusedHTML += '</div>';

      // 5) Copy Analysis Section
      let analysisHTML = '<div class="result-section"><h2>Copy Analysis</h2>';
      analysisHTML += `<p>Total word count: ${totalWordsCount}</p>`;
      analysisHTML += '<p>Highlighted copy with potential overused terms:</p>';
      analysisHTML += `<div class="results-box">${highlightedCopy}</div>`;
      analysisHTML += '</div>';

      // 6) Build the Niche Keywords Table
      let nicheAnalysisHTML = '<div class="result-section"><h2>Niche Keywords Analysis</h2>';
      if (relevantKeywords.length === 0) {
        nicheAnalysisHTML += '<p>No relevant keywords for your niche were detected.</p>';
      } else {
        nicheAnalysisHTML += '<table><tr><th>Niche</th><th>Keyword</th><th>Occurrences</th><th>Certainty</th></tr>';
        relevantKeywords.forEach(item => {
          const rawNiche = item.niche.toLowerCase().replace(/^guessed:\s*/, "");
          const nicheColor = getColorForNiche(rawNiche);
          const occColor = getOccurrencesColor(item.occurrences, avgOccurrence);
          const certColor = getCertaintyColor(item.certainty);
          nicheAnalysisHTML += `
            <tr>
              <td style="background-color:${nicheColor};">${item.niche}</td>
              <td>${item.keyword}</td>
              <td style="background-color:${occColor};">${item.occurrences}</td>
              <td style="background-color:${certColor};">${item.certainty}%</td>
            </tr>`;
        });
        nicheAnalysisHTML += '</table>';
      }

      // Different niche table
      if (differentKeywords.length > 0) {
        const groupMap = {};
        differentKeywords.forEach(it => {
          if (!groupMap[it.niche]) groupMap[it.niche] = [];
          groupMap[it.niche].push(it);
        });
        nicheAnalysisHTML += `<button class="toggle-btn" onclick="toggleDifferent()">Show Other Niches (${differentKeywords.length})</button>`;
        nicheAnalysisHTML += '<div id="differentSection" style="display:none; margin-top:15px;">';
        for (const group in groupMap) {
          nicheAnalysisHTML += `<h3>${group}</h3>`;
          nicheAnalysisHTML += '<table><tr><th>Keyword</th><th>Occurrences</th><th>Certainty</th></tr>';
          groupMap[group].forEach(item => {
            const rawNiche = item.niche.toLowerCase().replace(/^guessed:\s*/, "");
            const occColor = getOccurrencesColor(item.occurrences, avgOccurrence);
            const certColor = getCertaintyColor(item.certainty);
            nicheAnalysisHTML += `
              <tr>
                <td>${item.keyword}</td>
                <td style="background-color:${occColor};">${item.occurrences}</td>
                <td style="background-color:${certColor};">${item.certainty}%</td>
              </tr>`;
          });
          nicheAnalysisHTML += '</table>';
        }
        nicheAnalysisHTML += '</div>';
      }
      nicheAnalysisHTML += '</div>';

      // Final Output
      resultsDiv.innerHTML = analysisHTML + nicheAnalysisHTML + overusedHTML;
    });

    function toggleDifferent() {
      const section = document.getElementById("differentSection");
      section.style.display = (section.style.display === "none") ? "block" : "none";
    }

    /************************************************
     * Guess Niche Function with Safety
     ************************************************/
    function guessNiche(word) {
      const wLower = word.toLowerCase();
      // Manual overrides
      if (wLower === "blockchain") { return { niche: "tech", confidence: 100 }; }
      if (wLower === "networking") { return { niche: "business", confidence: 100 }; }

      let bestScore = 0;
      let bestNiche = null;
      for (const knownWord in knownKeywords) {
        const niche = knownKeywords[knownWord];
        const score = similarity(wLower, knownWord);
        if (score > bestScore) {
          bestScore = score;
          bestNiche = niche;
        }
      }
      if (bestScore < 0.3) {
        return null;
      }
      const confidence = Math.floor(bestScore * 100);
      return { niche: bestNiche, confidence };
    }

    /************************************************
     * Basic Similarity Function
     ************************************************/
    function similarity(a, b) {
      let matches = 0;
      const len = Math.min(a.length, b.length);
      for (let i = 0; i < len; i++) {
        if (a[i] === b[i]) matches++;
      }
      return matches / Math.max(a.length, b.length);
    }
  </script>
</body>
</html>
