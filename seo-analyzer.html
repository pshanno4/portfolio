<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Advanced A.I. SEO Analyzer</title>
  <style>
    /* Modern, sleek styling */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      background: #f0f2f5;
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      color: #333;
    }
    header {
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #fff;
    }
    .nav-left a {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 12px;
      border-radius: 4px;
      transition: background 0.3s ease;
      font-size: 0.95em;
    }
    .nav-left a:hover { background: rgba(255, 255, 255, 0.4); }
    .header-center { text-align: center; flex-grow: 1; }
    .header-center h1 {
      margin: 0; font-size: 2.5em; font-weight: 500;
    }
    .header-center p {
      margin: 5px 0 0; font-size: 1em; opacity: 0.9;
    }
    .container {
      max-width: 900px; margin: 30px auto;
      background: #fff; padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .input-group { margin-bottom: 20px; }
    .input-group label { display: block; margin-bottom: 8px; font-weight: 600; }
    .input-group select,
    .input-group textarea {
      width: 100%; padding: 12px;
      border: 1px solid #ddd; border-radius: 4px;
      font-size: 16px; transition: border-color 0.3s ease;
    }
    .input-group select:focus,
    .input-group textarea:focus { outline: none; border-color: #1e3c72; }
    button {
      background-color: #1e3c72; color: #fff;
      border: none; padding: 15px; width: 100%;
      border-radius: 4px; font-size: 18px; cursor: pointer;
      transition: background 0.3s ease; margin-top: 10px;
    }
    button:hover { background-color: #16335c; }
    .analysis { margin-top: 30px; }
    .result-section { margin-bottom: 30px; }
    .result-section h2 {
      margin-bottom: 10px; padding-bottom: 5px;
      border-bottom: 1px solid #ddd; font-weight: 600;
    }
    .result-section p, .result-section li { line-height: 1.6; }
    .highlight {
      background-color: #ffeb3b; padding: 2px 4px;
      border-radius: 3px; cursor: help;
    }
    .results-box {
      background: #f7f7f7; padding: 15px;
      border: 1px solid #ddd; border-radius: 4px;
      margin-top: 10px; font-family: Consolas, monospace;
      white-space: pre-wrap;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 10px; text-align: left; font-size: 0.95em; }
    th { background-color: #f9f9f9; font-weight: 600; }
    .toggle-btn {
      background: #1e3c72; color: #fff;
      border: none; padding: 10px 15px;
      border-radius: 4px; font-size: 0.9em;
      cursor: pointer; margin-top: 10px;
    }
    .info {
      background: #eef2f7; border: 1px solid #ccd4db;
      border-radius: 4px; padding: 15px; margin-top: 30px;
      font-size: 0.95em; line-height: 1.5;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-left">
      <a href="index.html">&larr; Return Home</a>
    </div>
    <div class="header-center">
      <h1>Advanced A.I. SEO Analyzer</h1>
      <p>Professional analysis for cutting-edge SEO performance</p>
    </div>
    <div style="width: 150px;"></div>
  </header>
  
  <div class="container">
    <!-- Niche Dropdown (Required) -->
    <div class="input-group">
      <label for="niche">Your Niche: <span style="color:red;">*</span></label>
      <select id="niche" required>
        <option value="">-- Select Your Niche --</option>
        <option value="tech">Tech</option>
        <option value="sustainability">Sustainability</option>
        <option value="finance">Finance</option>
        <option value="health">Health</option>
        <option value="travel">Travel</option>
        <option value="education">Education</option>
        <option value="fashion">Fashion</option>
        <option value="food">Food</option>
        <option value="real estate">Real Estate</option>
        <option value="entertainment">Entertainment</option>
        <option value="automotive">Automotive</option>
        <option value="sports">Sports</option>
        <option value="beauty">Beauty</option>
        <option value="retail">Retail</option>
        <option value="gaming">Gaming</option>
        <option value="lifestyle">Lifestyle</option>
        <option value="business">Business</option>
        <option value="legal">Legal</option>
        <option value="home improvement">Home Improvement</option>
        <option value="parenting">Parenting</option>
        <option value="marketing">Marketing</option>
        <option value="art & culture">Art & Culture</option>
      </select>
    </div>
    
    <!-- Main Copy Input (with maxlength 5000) -->
    <div class="input-group">
      <label for="copy">Your Copy:</label>
      <textarea id="copy" rows="10" maxlength="5000" placeholder="Paste your text here..."></textarea>
    </div>
    
    <!-- Analyze Button -->
    <button id="analyzeBtn">Analyze SEO</button>
    
    <!-- Analysis Results -->
    <div id="results" class="analysis"></div>
    
    <!-- In-Depth How It Works Section -->
    <div class="info">
      <h2>How It Works</h2>
      <p>
        This A.I.-powered SEO Analyzer processes your text in several steps:
      </p>
      <ol>
        <li>
          <strong>Text Normalization & Word Frequency:</strong> The tool first normalizes your copy by removing punctuation and converting all words to lowercase. It then calculates the frequency of each distinct word.
        </li>
        <li>
          <strong>Stopwords and Generic Word Filtering:</strong> An extensive blocklist (ignoreWords) removes nearly every generic English word—such as common prepositions, pronouns, determiners, conjunctions, as well as generic verbs, adjectives, adverbs, and nouns (e.g. “truly”, “recommendation(s)”, “access”, “appeal(s)”, “approach”, “even”, “maintaining”, “solution(s)”, “trusted”, “encourage(ing)”, “champion”, “adopt”, “advanced”, “amazing”, “ensuring”, “guide”, “interested”, “interest”, “introduce(d)”, “leading”, “reliable”, “remarkable”, “sharing”, “weve”, etc.). While context matters, this broad blocklist minimizes noise from non–industry–specific words.
        </li>
        <li>
          <strong>Keyword Classification:</strong> For each remaining word, the analyzer checks if it is present in our predefined industry-specific mapping. If a word is an exact match, it is assigned to that niche with a certainty score of 100. For words not found in our mapping, a similarity algorithm (comparing character-by-character overlap) attempts to guess the most likely niche and assigns a confidence score.
        </li>
        <li>
          <strong>Occurrence Analysis:</strong> The tool calculates the average occurrence of all relevant keywords. If a keyword appears at least twice the average, its occurrence cell is highlighted in yellow; if three times or more, it is highlighted in red.
        </li>
        <li>
          <strong>Certainty Scoring & Coloring:</strong> In the main table, keywords that match your chosen niche show a numeric certainty value (green if 70–100, yellow if 40–70, and red if below 40). For keywords from a different niche, the tool now also calculates and displays a numeric certainty score (typically 100 for exact matches or the guess’s confidence for approximations) using the same color-coding.
        </li>
        <li>
          <strong>Dual Table Display:</strong> The results are split into two tables. The main table displays keywords relevant to your selected niche, while a secondary section—hidden by default—groups keywords detected as belonging to a different niche (organized by niche). A toggle button allows you to expand or collapse the “Different Niche” table for a concise view.
        </li>
        <li>
          <strong>Final Presentation:</strong> All results are presented in a modern, sleek interface with color-coded cells for quick visual analysis.
        </li>
      </ol>
      <p>
        The math behind the similarity function is simple: for two words, the number of matching characters (in order) is divided by the maximum length of the two words to produce a ratio. This ratio is then multiplied by 100 to yield a confidence percentage. Occurrence coloring compares each keyword’s count against the mean count of all relevant keywords.
      </p>
    </div>
  </div>
  
  <script>
    /************************************************
     *        Overused SEO Keywords (Highlight)     *
     ************************************************/
    const overusedWords = [
      "best", "top", "quality", "expert", "affordable", "solution", "unique", "leading",
      "powerful", "reliable", "trusted", "proven", "innovative", "cutting-edge",
      "state-of-the-art", "free", "guaranteed", "amazing", "ultimate", "essential",
      "premium", "efficient", "advanced", "strategic", "professional", "dynamic",
      "holistic", "comprehensive", "optimal", "incredible", "remarkable"
    ];
    
    /************************************************
     *    Expanded Stopwords / Ignore List          *
     * (Very extensive generic word blocklist)      *
     ************************************************/
    const ignoreWords = [
      // Standard stopwords
      "i", "me", "my", "myself", "we", "our", "ours", "ourselves", "you", "your", "yours",
      "yourself", "yourselves", "he", "him", "his", "himself", "she", "her", "hers", "herself",
      "it", "its", "itself", "they", "them", "their", "theirs", "themselves",
      "what", "which", "who", "whom", "this", "that", "these", "those",
      "am", "is", "are", "was", "were", "be", "been", "being",
      "have", "has", "had", "having", "do", "does", "did", "doing",
      "a", "an", "the", "and", "but", "if", "or", "because", "as", "until", "while",
      "of", "at", "by", "for", "with", "about", "against", "between", "into",
      "through", "during", "before", "after", "above", "below", "to", "from",
      "up", "down", "in", "out", "on", "off", "over", "under", "again", "further",
      "then", "once", "here", "there", "when", "where", "why", "how",
      "all", "any", "both", "each", "few", "more", "most", "other", "some", "such",
      "no", "nor", "not", "only", "own", "same", "so", "than", "too", "very",
      "s", "t", "can", "will", "just", "don", "should", "now",
      // Additional common prepositions, connectors, etc.
      "about", "above", "across", "after", "against", "along", "amid", "amidst", "among", "amongst",
      "anti", "around", "as", "at", "before", "behind", "below", "beneath", "beside", "besides",
      "between", "beyond", "but", "by", "concerning", "despite", "down", "during", "except", "excepting",
      "excluding", "following", "for", "from", "in", "inside", "into", "like", "minus", "near",
      "of", "off", "on", "onto", "opposite", "out", "outside", "over", "past", "per", "plus",
      "regarding", "round", "save", "since", "than", "through", "to", "toward", "towards", "under",
      "underneath", "unlike", "until", "up", "upon", "versus", "via", "with", "within", "without",
      // Additional generic adjectives, adverbs, nouns, verbs
      "really", "quite", "much", "many", "also", "often", "ever", "never", "always", "sometimes",
      "indeed", "perhaps", "maybe", "probably", "certainly", "basically", "generally", "mostly", "simply",
      "actually", "thing", "things", "stuff", "anything", "everything", "something", "event", "events",
      "item", "items", "object", "objects", "big", "small", "large", "little", "next", "previous", "new",
      "old", "several", "more", "less", "few", "generic", "common", "standard",
      // Additional generic verbs and expressions (non-industry)
      "do", "make", "take", "get", "go", "come", "say", "tell", "see", "look", "use", "work", "run",
      "start", "end", "finish", "begin", "continue", "stop", "find", "keep", "hold", "put", "think",
      "know", "want", "need", "like", "love", "hate", "live", "die", "give", "buy", "sell", "build",
      "create", "share", "ensure", "forget", "join", "connect", "network", "networking",
      // Additional words per your request
      "truly", "recommendation", "recommendations", "access", "appeal", "appeals", "approach", "even",
      "maintaining", "solution", "solutions", "trusted", "encourage", "encouraging", "champion",
      "adopt", "advanced", "amazing", "ensuring", "guide", "interested", "interest", "introduce",
      "introduced", "leading", "reliable", "remarkable", "sharing", "weve",
      // You can add even more generic terms as needed...
      "advice", "tips", "age"
    ];
    
    /************************************************
     *       Niche Mapping and Known Keywords       *
     ************************************************/
    const nicheMapping = {
      "tech": [
        "ai", "machine", "learning", "technology", "tech", "robotics", "data", "science",
        "innovation", "software", "hardware", "cybersecurity", "gadgets", "iot",
        "cloud", "big", "automation", "blockchain"
      ],
      "sustainability": [
        "nature", "recycling", "reuse", "sustainable", "environment", "green", "eco",
        "renewable", "conservation", "organic", "biodiversity", "carbon", "footprint",
        "waste", "management"
      ],
      "finance": [
        "investment", "stocks", "cryptocurrency", "banking", "loans", "finance", "trading",
        "financial", "planning", "wealth", "insurance", "budget", "economics",
        "interest", "rates", "savings", "tax", "dividends", "portfolio", "retirement"
      ],
      "health": [
        "health", "wellness", "nutrition", "fitness", "exercise", "medicine", "mental",
        "medical", "diet", "treatment", "prevention", "wellbeing", "therapy", "healthcare",
        "doctor", "clinic"
      ],
      "travel": [
        "travel", "vacation", "tourism", "destination", "holiday", "flight", "hotel",
        "adventure", "explore", "journey", "itinerary", "cruise", "sightseeing",
        "backpacking", "road", "trip"
      ],
      "education": [
        "education", "learning", "courses", "classes", "tutoring", "scholarship",
        "university", "college", "academic", "research", "training", "e-learning",
        "study", "curriculum"
      ],
      "fashion": [
        "fashion", "style", "trends", "apparel", "clothing", "accessories", "couture",
        "designer", "runway", "vintage", "moda", "outfit", "wardrobe", "glamour", "chic"
      ],
      "food": [
        "food", "cuisine", "recipe", "dining", "restaurant", "gourmet", "chef", "cooking",
        "meal", "snack", "flavor", "organic", "fast", "bakery", "delicious", "savory"
      ],
      "real estate": [
        "real", "estate", "property", "homes", "housing", "mortgage", "apartment",
        "commercial", "condo", "residential", "rentals", "market", "construction"
      ],
      "entertainment": [
        "entertainment", "movies", "music", "celebrity", "tv", "film", "concert",
        "streaming", "theater", "festival", "pop", "culture", "blockbuster", "award",
        "drama", "comedy"
      ],
      "automotive": [
        "automotive", "cars", "vehicles", "auto", "transportation", "engine", "dealership",
        "electric", "hybrid", "suv", "sedan", "trucks", "performance", "motor", "driving"
      ],
      "sports": [
        "sports", "football", "basketball", "soccer", "baseball", "tennis", "athlete",
        "tournament", "game", "league", "score", "coach", "stadium", "olympics",
        "competition"
      ],
      "beauty": [
        "beauty", "skincare", "makeup", "cosmetics", "hair", "spa", "salon", "anti-aging",
        "fragrance", "esthetic", "organic", "glam", "chic"
      ],
      "retail": [
        "retail", "shopping", "e-commerce", "store", "discount", "sale", "deal", "consumer",
        "online", "delivery", "customer", "service", "brand", "merchandise"
      ],
      "gaming": [
        "gaming", "video", "games", "esports", "console", "pc", "multiplayer", "rpg",
        "fps", "strategy", "gameplay", "virtual", "tournament", "beta"
      ],
      "lifestyle": [
        "lifestyle", "culture", "living", "home", "decor", "diy", "personal", "development",
        "hobbies", "mindfulness", "fitness", "art", "entertainment"
      ],
      "business": [
        "business", "entrepreneur", "startup", "management", "leadership", "strategy",
        "growth", "marketing", "sales", "operations", "corporate", "b2b", "b2c", "industry",
        "networking"
      ],
      "legal": [
        "legal", "law", "attorney", "lawsuit", "regulation", "compliance", "court",
        "contract", "litigation", "policy", "rights", "justice", "criminal", "civil"
      ],
      "home improvement": [
        "home", "improvement", "diy", "renovation", "remodel", "construction",
        "interior", "exterior", "maintenance", "repair", "architecture", "landscaping",
        "decor"
      ],
      "parenting": [
        "parenting", "kids", "children", "family", "mom", "dad", "parent", "childcare",
        "baby", "toddler", "advice", "support", "growth"
      ],
      "marketing": [
        "marketing", "advertising", "branding", "content", "social", "media", "seo",
        "analytics", "campaign", "digital", "inbound", "engagement", "influencer",
        "lead", "generation"
      ],
      "art & culture": [
        "art", "culture", "gallery", "exhibition", "artist", "creative", "design",
        "museum", "craft", "sculpture", "painting", "installation", "performance", "curator"
      ]
    };
    
    /************************************************
     *            Niche Colors for Table            *
     ************************************************/
    const nicheColors = {
      "tech": "#d1ecf1",
      "sustainability": "#d4edda",
      "finance": "#fff3cd",
      "health": "#f8d7da",
      "travel": "#cce5ff",
      "education": "#e2e3e5",
      "fashion": "#f5dbf5",
      "food": "#ffeed4",
      "real estate": "#e6e6e6",
      "entertainment": "#ececff",
      "automotive": "#e4fcef",
      "sports": "#f0e6ff",
      "beauty": "#ffe6f2",
      "retail": "#e6fff5",
      "gaming": "#ffe6cc",
      "lifestyle": "#f4f4f4",
      "business": "#ddefef",
      "legal": "#e7e7e7",
      "home improvement": "#f9f6e8",
      "parenting": "#fde8e8",
      "marketing": "#f0ffe4",
      "art & culture": "#fffae6"
    };
    
    /************************************************
     *    Build a Quick-Look Dictionary (lowercase) *
     ************************************************/
    const knownKeywords = {};
    for (const niche in nicheMapping) {
      nicheMapping[niche].forEach(keyword => {
        const lowerKey = keyword.toLowerCase();
        if (!knownKeywords[lowerKey]) { knownKeywords[lowerKey] = niche; }
      });
    }
    
    /************************************************
     *    Text Normalization / Word Frequency       *
     ************************************************/
    function normalizeWord(word) {
      return word.replace(/[^a-zA-Z0-9]/g, "").toLowerCase();
    }
    
    function getWordFrequencies(text) {
      const freqMap = {};
      const rawWords = text.split(/\s+/);
      for (let raw of rawWords) {
        const w = normalizeWord(raw);
        if (w) { freqMap[w] = (freqMap[w] || 0) + 1; }
      }
      return freqMap;
    }
    
    /************************************************
     *    Refined Guess Niche for Unknown Keyword     *
     ************************************************/
    function guessNiche(word) {
      const wLower = word.toLowerCase();
      // Manual overrides
      if (wLower === "blockchain") { return { niche: "tech", confidence: 100 }; }
      if (wLower === "networking") { return { niche: "business", confidence: 100 }; }
      let bestScore = 0;
      let bestNiche = null;
      for (const knownWord in knownKeywords) {
        const niche = knownKeywords[knownWord];
        const score = similarity(wLower, knownWord);
        if (score > bestScore) { bestScore = score; bestNiche = niche; }
      }
      if (bestScore < 0.3) { return null; }
      const confidence = Math.floor(bestScore * 100);
      return { niche: bestNiche, confidence };
    }
    
    function similarity(a, b) {
      let matches = 0;
      const len = Math.min(a.length, b.length);
      for (let i = 0; i < len; i++) { if (a[i] === b[i]) { matches++; } }
      return matches / Math.max(a.length, b.length);
    }
    
    /************************************************
     *   Color Helpers for Occurrences and Certainty *
     ************************************************/
    function getColorForNiche(niche) {
      if (!niche) return "#ffffff";
      const nicheLower = niche.toLowerCase();
      return nicheColors[nicheLower] || "#ffffff";
    }
    
    // Occurrence color based on ratio and deviation from average
    function getOccurrencesColor(occurrences, avg) {
      let baseRatio = occurrences / totalWordsCount;
      // Override: if occurrences are >= 3x average, red; if >=2x, yellow.
      if (avg > 0) {
        if (occurrences >= 3 * avg) { return "#ffcccc"; }
        else if (occurrences >= 2 * avg) { return "#fff5cc"; }
      }
      // Otherwise, use default ratio-based coloring
      if (baseRatio > 0.1) { return "#ffcccc"; }
      else if (baseRatio > 0.05) { return "#fff5cc"; }
      else { return "#ccffcc"; }
    }
    
    // Certainty coloring: 70-100 = green, 40-70 = yellow, below 40 = red.
    function getCertaintyColor(certainty) {
      if (typeof certainty === "number") {
        if (certainty >= 70) { return "#ccffcc"; }
        else if (certainty >= 40) { return "#fff5cc"; }
        else { return "#ffcccc"; }
      }
      return "#ffcccc";
    }
    
    let totalWordsCount = 0; // global to use in occurrence coloring
    
    /************************************************
     *           Main Analysis Logic                *
     ************************************************/
    document.getElementById('analyzeBtn').addEventListener('click', function() {
      const inputNiche = document.getElementById('niche').value.trim();
      const copy = document.getElementById('copy').value;
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = "";
      
      if (!inputNiche) {
        resultsDiv.innerHTML = '<p style="color:red;">Please select your niche to proceed.</p>';
        return;
      }
      if (!copy) {
        resultsDiv.innerHTML = '<p>Please enter some copy to analyze.</p>';
        return;
      }
      
      // 1) Highlight overused SEO keywords in copy
      const overusedRegex = new RegExp('\\b(' + overusedWords.join('|') + ')\\b', 'gi');
      const highlightedCopy = copy.replace(overusedRegex, function(match) {
        return '<span class="highlight" title="This term may be overused. Consider using synonyms.">' + match + '</span>';
      });
      
      // 2) Build word frequency for the copy
      const freqMap = getWordFrequencies(copy);
      totalWordsCount = Object.values(freqMap).reduce((a, b) => a + b, 0);
      
      // 3) Analyze keywords: separate into relevant (matching input niche) and different
      const relevantKeywords = [];
      const differentKeywords = [];
      const inputNicheLower = inputNiche.toLowerCase();
      
      for (const word in freqMap) {
        const occurrences = freqMap[word];
        if (ignoreWords.includes(word)) { continue; }
        
        if (knownKeywords[word]) {
          const knownNiche = knownKeywords[word];
          if (knownNiche.toLowerCase() === inputNicheLower) {
            relevantKeywords.push({
              niche: knownNiche,
              keyword: word,
              occurrences,
              certainty: 100 // exact match = 100%
            });
          } else {
            // For known keywords not in input niche, assign 100% certainty (since it's an exact mapping)
            differentKeywords.push({
              niche: knownNiche,
              keyword: word,
              occurrences,
              certainty: 100
            });
          }
        } else {
          const guess = guessNiche(word);
          if (guess) {
            if (guess.niche.toLowerCase() === inputNicheLower) {
              relevantKeywords.push({
                niche: "Guessed: " + guess.niche,
                keyword: word,
                occurrences,
                certainty: guess.confidence
              });
            } else {
              differentKeywords.push({
                niche: "Guessed: " + guess.niche,
                keyword: word,
                occurrences,
                certainty: guess.confidence
              });
            }
          }
        }
      }
      
      // Compute average occurrences for relevant keywords (for occurrence coloring)
      let avgOccurrence = 0;
      if (relevantKeywords.length > 0) {
        const sumOccurrences = relevantKeywords.reduce((sum, item) => sum + item.occurrences, 0);
        avgOccurrence = sumOccurrences / relevantKeywords.length;
      }
      
      // Sort relevant keywords by niche then keyword
      relevantKeywords.sort((a, b) => {
        if (a.niche < b.niche) return -1;
        if (a.niche > b.niche) return 1;
        return a.keyword.localeCompare(b.keyword);
      });
      
      // Sort different keywords by keyword
      differentKeywords.sort((a, b) => a.keyword.localeCompare(b.keyword));
      
      // 4) Overused keywords analysis (as before)
      const overusedCounts = {};
      overusedWords.forEach(word => {
        const regex = new RegExp('\\b' + word + '\\b', 'gi');
        const matches = copy.match(regex);
        overusedCounts[word] = matches ? matches.length : 0;
      });
      
      let overusedHTML = '<div class="result-section"><h2>Overused SEO Keywords Analysis</h2><ul>';
      let foundOverused = false;
      for (const [word, count] of Object.entries(overusedCounts)) {
        if (count > 0) {
          foundOverused = true;
          overusedHTML += '<li><strong>' + word + '</strong>: ' + count + ' occurrence' + (count > 1 ? 's' : '') + '</li>';
        }
      }
      overusedHTML += '</ul>';
      if (!foundOverused) {
        overusedHTML += '<p>No overused SEO keywords were detected in your copy!</p>';
      } else {
        overusedHTML += '<p>Review the highlighted terms above; consider using synonyms for a more natural language flow.</p>';
      }
      overusedHTML += '</div>';
      
      // 5) Copy Analysis Section
      let analysisHTML = '<div class="result-section"><h2>Copy Analysis</h2>';
      analysisHTML += '<p>Total word count: ' + totalWordsCount + '</p>';
      analysisHTML += '<p>Highlighted copy with potential overused terms:</p>';
      analysisHTML += '<div class="results-box">' + highlightedCopy + '</div>';
      analysisHTML += '</div>';
      
      // 6) Build the Relevant Keywords Table (Main Table)
      let nicheAnalysisHTML = '<div class="result-section"><h2>Niche Keywords Analysis</h2>';
      if (relevantKeywords.length === 0) {
        nicheAnalysisHTML += '<p>No relevant keywords for your niche were detected.</p>';
      } else {
        nicheAnalysisHTML += '<table><tr><th>Niche</th><th>Keyword</th><th>Occurrences</th><th>Certainty</th></tr>';
        relevantKeywords.forEach(item => {
          let displayNiche = item.niche;
          let rawNiche = displayNiche.toLowerCase();
          if (displayNiche.toLowerCase().startsWith("guessed: ")) {
            rawNiche = displayNiche.replace(/guessed:\s*/i, "").toLowerCase();
          }
          const nicheColor = getColorForNiche(rawNiche);
          const occColor = getOccurrencesColor(item.occurrences, avgOccurrence);
          const certColor = getCertaintyColor(item.certainty);
          nicheAnalysisHTML += `
            <tr>
              <td style="background-color:${nicheColor};">${displayNiche}</td>
              <td>${item.keyword}</td>
              <td style="background-color:${occColor};">${item.occurrences}</td>
              <td style="background-color:${certColor};">${item.certainty}%</td>
            </tr>`;
        });
        nicheAnalysisHTML += '</table>';
      }
      
      // 7) Build the Different Niche Keywords Table (Grouped by Niche)
      if (differentKeywords.length > 0) {
        const groupMap = {};
        differentKeywords.forEach(item => {
          const key = item.niche;
          if (!groupMap[key]) { groupMap[key] = []; }
          groupMap[key].push(item);
        });
        nicheAnalysisHTML += '<button class="toggle-btn" onclick="toggleDifferent()">Show Different Niche Keywords (' + differentKeywords.length + ')</button>';
        nicheAnalysisHTML += '<div id="differentSection" style="display:none; margin-top:15px;">';
        for (const group in groupMap) {
          nicheAnalysisHTML += '<h3>' + group + '</h3>';
          nicheAnalysisHTML += '<table><tr><th>Keyword</th><th>Occurrences</th><th>Certainty</th></tr>';
          groupMap[group].forEach(item => {
            const occColor = getOccurrencesColor(item.occurrences, avgOccurrence);
            const certColor = getCertaintyColor(item.certainty);
            nicheAnalysisHTML += `
              <tr>
                <td>${item.keyword}</td>
                <td style="background-color:${occColor};">${item.occurrences}</td>
                <td style="background-color:${certColor};">${item.certainty}%</td>
              </tr>`;
          });
          nicheAnalysisHTML += '</table>';
        }
        nicheAnalysisHTML += '</div>';
      }
      
      nicheAnalysisHTML += '</div>';
      
      // 8) Combine and Display All Results
      resultsDiv.innerHTML = analysisHTML + nicheAnalysisHTML + overusedHTML;
    });
    
    // Toggle function for showing/hiding the Different Niche keywords section
    function toggleDifferent() {
      const section = document.getElementById("differentSection");
      section.style.display = (section.style.display === "none") ? "block" : "none";
    }
  </script>
</body>
</html>
